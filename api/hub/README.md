# AWF Hub

## Prerequisites
### Textile
* Get the Textile daemon running on your local machine
  * From a prebuilt package https://github.com/textileio/textile/releases, or
  * From source https://github.com/textileio/textile, you will need to install Go as well
* Create an account https://docs.textile.io/hub/accounts/#account-setup

### Algolia
* You will need to create an account at https://www.algolia.com/
* Create an index
* Import the provided config file into your index under Manage Index / Import Configuration

### Infura
* You will need to create an account at https://infura.io/

## Populating the .env file
* **APP_API_KEY** (account)
* **APP_API_SECRET** (account)
* **USER_GROUP_API_KEY** (usergroup)
* **USER_GROUP_API_SECRET** (usergroup)

These variables are generated via the Textile hub (twice, for account and usergroup keys)\
Always pick 'Require Signature Authentication' option.
```
hub keys create -o AWF_DEV
```
##
* **AWF_THREADdb**
* **AWF_DBkey**
* **AWF_DBname**

**AWF_DBname** can be anything you want, as long as it's unique -  but **do not use special characters!**
**AWF_DBKey** and **AWF_THREADdb** generation is a bit involved, as follows:
###
* In /api/hub/src/index.ts, temporarily comment out the following, as *api* import will try to use the 
still non-existing variables and crash.
```
import api, { promRegistry } from './api';
```
```
app.use(api.routes());
app.use(api.allowedMethods());
```
```
createMetricsPlugin(promRegistry),
```
###
* In /api/hub/src/helpers.ts, first comment out the line
```
const identity = () => PrivateKey.fromString(process.env.AWF_DBkey);
```
and temporarily add the following, so you can store the value of **AWF_DBkey** in the .env file permanently.\
The value of the private key is used to import to Metamask, as well as for the Infura **AWF_FAUCET_KEY**.
```
const identity = () => {
  const key = PrivateKey.fromRandom();
  const stringKey = key.toString();
  console.log('AWF_DBkey ------------------------------------------------->');
  console.log(stringKey);
  console.log('PRIVATE_KEY ----------------------------------------------->');
  console.log(Buffer.from(key.seed).toString('hex'));
  return key;
};
```
###
* In the same file (/api/hub/src/helpers.ts), after
```
  const threadID = process.env.AWF_THREADdb
    ? ThreadID.fromString(process.env.AWF_THREADdb)
    : ThreadID.fromRandom();
  ```
add the following, this will become the value for **AWF_THREADdb** .env variable
```
console.log('AWF_THREADdb ------------------------------------------->');
console.log(threadID.toString());
```
##
* **AWF_SEARCH_ID**
* **AWF_SEARCH_KEY**
* **AWF_SEARCH_INDEX**

These variables are generated by Algolia.\
For **AWF_SEARCH_INDEX** pick whatever you like in the Algolia setup.\
**AWF_SEARCH_ID** is your Application ID under API Keys in the Algolia console.\
**AWF_SEARCH_KEY** is your Search-Only under API Keys in the Algolia console.

##
* **AWF_FAUCET_ID**
* **AWF_FAUCET_KEY**
* **AWF_FAUCET_SECRET**
* **AWF_FAUCET_NETWORK**

These variables are mostly generated by Infura.\
**AWF_FAUCET_ID** and **AWF_FAUCET_SECRET** can be found in Infura, after you create an Ethereum project,
in the Settings tab as _PROJECT ID_ and _PROJECT SECRET_.\
**AWF_FAUCET_KEY** is the private key we generated in the previous steps, or the one from Metamask.
**AWF_FAUCET_NETWORK** is _rinkeby_.

###
Finally, for **ALLOWED_ORIGINS**, use an array with allowed origins, with the form of "host:port".


## Run
For development purposes, from the root of this project:

```shell script
npm run dev:server
```
#

